<!DOCTYPE html>
<html>
<head>
    <title>서울 큐레이션 맵 - Final Edition</title>
    <meta charset="utf-8">
    <style>
        body { margin: 0; padding: 0; font-family: 'Noto Sans KR', sans-serif; }
        
        #map {
            height: 100vh;
            width: 100%;
        }

        /* 필터 박스 */
        #filter-box {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            z-index: 10;
            min-width: 140px;
            max-height: 80vh;
            overflow-y: auto;
        }
        #filter-box h3 {
            margin: 0 0 10px 0;
            font-size: 15px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        .filter-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 13px;
            cursor: pointer;
        }
        .filter-item input { margin-right: 8px; cursor: pointer; }
        .curator-color-dot {
            display: inline-block;
            width: 10px; height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        /* 정보창 스타일 */
        .info-box {
            padding: 5px;
            color: #333;
            width: 230px;
        }
        .info-box h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .info-box .curator-tag {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
            display: block;
            font-weight: bold;
        }
        .info-box .desc-area {
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 10px;
            color: #444;
            border-top: 1px solid #eee;
            padding-top: 8px;
        }
        .toggle-btn {
            color: #4285F4;
            cursor: pointer;
            font-size: 12px;
            text-decoration: underline;
            border: none;
            background: none;
            padding: 0;
            margin-left: 5px;
        }

        /* 평점 배지 스타일 */
        .score-badge {
            background-color: #f1c40f; 
            color: #fff;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            float: right;
        }
        .score-badge:hover {
            background-color: #f39c12;
        }
        
        /* 스크롤바 커스텀 */
        #filter-box::-webkit-scrollbar { width: 6px; }
        #filter-box::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 3px; }
    </style>
</head>
<body>

    <div id="filter-box">
        <h3>큐레이터 Filter</h3>
        <div id="checkbox-container"></div>
    </div>

    <div id="map"></div>

    <script>
        // 1. 큐레이터 설정
        const curators = {
            "제헌": { color: "#FF5733", iconUrl: "http://maps.google.com/mapfiles/ms/icons/red-dot.png" },
            "지해": { color: "#33FF57", iconUrl: "http://maps.google.com/mapfiles/ms/icons/green-dot.png" },
            "예빈": { color: "#3357FF", iconUrl: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png" },
            "나의시선": { color: "#F333FF", iconUrl: "http://maps.google.com/mapfiles/ms/icons/purple-dot.png" },
            "서진": { color: "#FF33A8", iconUrl: "http://maps.google.com/mapfiles/ms/icons/pink-dot.png" }
        };

        // 2. 맛집 데이터 (평점 score는 예시로 넣음)
        const restaurants = [
            // --- 제헌 ---
            { curator: "제헌", name: "비야게레로", lat: 37.511964, lng: 127.052805, desc: "멕시코에 왜 가나요? 한국에 있는데.", score: "4.8" },
            { curator: "제헌", name: "호두까기 호두과자", lat: 37.552875, lng: 127.009883, desc: "뜬금없이 호두과자 먹고 싶을 때. 본점은 경기도 청평. 분점은 약수에 있어요.", score: "4.5" },
            { curator: "제헌", name: "성천막국수", lat: 37.569899, lng: 127.057818, desc: "60년된 막국수집. 자주 가던 곳인데 성시경이 다녀간 뒤로 포기. 그가 밉습니다.", score: "4.7" },
            { curator: "제헌", name: "운봉산장", lat: 37.508102, lng: 126.940339, desc: "서울에서 양고기집을 단 한곳만 추천한다면. 최소한 일주일 전에는 예약해야 합니다.", score: "4.9" },
            { curator: "제헌", name: "서부감자국", lat: 37.602264, lng: 126.926953, desc: "제2의 고향. 합성숭실", score: "4.6" },
            { curator: "제헌", name: "안암", lat: 37.579443, lng: 126.984419, desc: "정말 다 좋은데 주말엔 4시간 기다려야..집에서 씻고 누우면 자리났다고 연락와요.", score: "4.8" },
            { curator: "제헌", name: "경춘자의 라면 땡기는 날", lat: 37.579155, lng: 126.981328, desc: "한국인이라면 매콤한 라면 안먹고 배기나요?", score: "4.4" },
            { curator: "제헌", name: "라멘 시미즈", lat: 37.555845, lng: 126.910602, desc: "늘 일본에서 여기를 이길 수 있는 집을 찾고 있는데 아직 못찾았어요. 시오 라멘 대장.", score: "4.7" },
            { curator: "제헌", name: "중앙해장", lat: 37.508298, lng: 127.065448, desc: "제3의 고향.", score: "4.5" },
            { curator: "제헌", name: "시네큐브", lat: 37.569922, lng: 126.970535, desc: "영화는 마음의 양식.", score: "5.0" },
            { curator: "제헌", name: "큔", lat: 37.579040, lng: 126.965800, desc: "서울에서 가장 애정하는 비건 식당. 마음씨 고운 사람같은 곳.", score: "4.9" },
            { curator: "제헌", name: "옥경이네 건생선", lat: 37.567010, lng: 127.016350, desc: "오징어에도 등급이 있다면 아마도 투플러스. 환상적인 반건조 오징어 구이.", score: "4.6" },
            { curator: "제헌", name: "진미평양냉면", lat: 37.516130, lng: 127.036040, desc: "이런 평냉 또 없습니다.", score: "4.7" },
            { curator: "제헌", name: "수퍼", lat: 37.542850, lng: 126.951300, desc: "긴말 필요 없는 수프 전문점. 그냥 드세요.", score: "4.5" },
            { curator: "제헌", name: "풍년삼계탕", lat: 37.567500, lng: 126.975700, desc: "들깨삼계탕을 시키면 인삼주가 나와요. 주객전도.", score: "4.4" },
            { curator: "제헌", name: "금산제면소", lat: 37.560600, lng: 126.985600, desc: "고해성사. 오너가 직원을 폭행한 뒤로 정말 가지 말아야지 다짐하는데 갑니다..", score: "4.3" },
            { curator: "제헌", name: "하동관", lat: 37.564400, lng: 126.984000, desc: "제4의 고향.", score: "4.6" },
            { curator: "제헌", name: "부영도가니탕", lat: 37.571400, lng: 126.983000, desc: "50년된 노포. 시간은 거짓말하지 않습니다.", score: "4.7" },
            { curator: "제헌", name: "서울서둘째로잘하는집", lat: 37.586600, lng: 126.982200, desc: "아름다운 단팥죽. 너무 겸손하신듯.", score: "4.8" },
            { curator: "제헌", name: "진주회관", lat: 37.562750, lng: 126.975500, desc: "콩국수를 먹지 않으면 여름은 오지 않습니다.", score: "4.9" },
            { curator: "제헌", name: "철철복집", lat: 37.567900, lng: 126.981600, desc: "복지리를 먹지 않으면 겨울은 오지 않습니다.", score: "4.8" },
            { curator: "제헌", name: "우래옥", lat: 37.568200, lng: 126.998700, desc: "영원하리.", score: "4.9" },
            // --- 지해 ---
            { curator: "지해", name: "KITH 성수", lat: 37.544150, lng: 127.052050, desc: "사실 고백하자면 나는 뉴욕 소호에 있는 kith에서 아이스크림을 먹음...", score: "4.5" },
            { curator: "지해", name: "so far", lat: 37.545000, lng: 127.045000, desc: "젤라또를 안주로 와인 한 잔! 안취하고 계속 와인 마실 수 있음...", score: "4.6" },
            { curator: "지해", name: "포틀러", lat: 37.546050, lng: 127.043050, desc: "캠핑은 가고싶지만 도시를 벗어나기 싫은 사람들의 캠핑 감성 1%...", score: "4.4" },
            { curator: "지해", name: "중앙감속기", lat: 37.545800, lng: 127.050500, desc: "여긴 퓨전 중국음식점인데, 최현석셰프의 제자가 오픈한 곳임...", score: "4.5" },
            { curator: "지해", name: "백년화편", lat: 37.534200, lng: 127.135000, desc: "밥알이 씹히는 밥알 찹쌀떡으로 유명하고 명인이 만드는 대한민국 5대떡집...", score: "4.7" },
            { curator: "지해", name: "크레뮤클럽", lat: 37.546500, lng: 127.042500, desc: "아 여기 진짜 최고임. 여기 프랜치 토스트 맛집으로 유명한데...", score: "4.8" },
            { curator: "지해", name: "하이볼가든", lat: 37.521800, lng: 127.022500, desc: "난 위스키는 즐기지 않지만 하이볼은 좋아함...", score: "4.6" },
            { curator: "지해", name: "라비옥", lat: 37.505000, lng: 127.055000, desc: "예전 회사 근처 갈비집인데, 원래 회사 근처 맛집은 자주 가서 기억을 하기 때문에...", score: "4.4" },
            { curator: "지해", name: "아바이왕순대", lat: 37.546000, lng: 126.965000, desc: "여기 진입장벽 조금 있지만 중독성 있는 맛집 소개해드림...", score: "4.5" },
            { curator: "지해", name: "논현손칼국수", lat: 37.509700, lng: 127.034500, desc: "맛있는 칼국수집임. 수제비도 파는데 수제비를 먹을 지...", score: "4.6" },
            { curator: "지해", name: "신동궁감자탕", lat: 37.499600, lng: 127.028700, desc: "뼈찜! 매운 뼈찜 맛집. 여기는 술 취해서 2차? 3차? 정도에...", score: "4.7" },
            { curator: "지해", name: "몽촌토성", lat: 37.550000, lng: 127.200000, desc: "이름은 몽촌토성이지만 몽촌토성 말고 하남에 있음...", score: "4.5" },
            { curator: "지해", name: "시가올 비빔국수", lat: 37.565000, lng: 127.150000, desc: "나 사실 국수 좋아함.. 여기도 국수집인데 여러번 간...", score: "4.6" },
            { curator: "지해", name: "최사장네닭", lat: 37.560500, lng: 126.924500, desc: "연남동쪽에 있는 닭도리탕 맛집인데 기본 메뉴로...", score: "4.5" },
            { curator: "지해", name: "완차이", lat: 37.557300, lng: 126.937000, desc: "지금 기억 속 맛집 끄집어내다가 찾았는데 아직도 운영중이라니...", score: "4.4" },
            // --- 예빈 ---
            { curator: "예빈", name: "한공간", lat: 37.552000, lng: 126.935000, desc: "경의선숲길 안쪽에 위치한 1인셰프 레스토랑...", score: "4.7" },
            { curator: "예빈", name: "파사주", lat: 37.555000, lng: 126.930000, desc: "공덕-대흥역 사이 경의선광장에 바로 붙어있는 프렌치 레스토랑...", score: "4.8" },
            { curator: "예빈", name: "와일드덕 칸틴", lat: 37.540000, lng: 126.985000, desc: "와일드덕 칸틴은 하나하나 먹을 때 마다 ‘이게 왜 맛있지?’...", score: "4.6" },
            { curator: "예빈", name: "울버린시티", lat: 37.542000, lng: 126.986000, desc: "사장님이 정말 울버린을 닮았다. 추천메뉴는 가지그라탕과...", score: "4.5" },
            { curator: "예빈", name: "신승호 라멘집", lat: 37.551000, lng: 126.915000, desc: "아부라소바 하나만 파는 진짜 라멘 맛집이다...", score: "4.7" },
            { curator: "예빈", name: "안덕", lat: 37.578000, lng: 126.968000, desc: "서촌에서 일하는 친구들에게 10번은 추천받은 만둣국집...", score: "4.6" },
            { curator: "예빈", name: "굽", lat: 37.565000, lng: 127.015000, desc: "신당에 위치한 와인바. 추천메뉴는 메쉬드 포테이토와...", score: "4.5" },
            { curator: "예빈", name: "양키통닭", lat: 37.513500, lng: 126.889000, desc: "문래동 맛집. 오리지널 시금치, 페퍼크림...", score: "4.8" },
            { curator: "예빈", name: "타파코파", lat: 37.535000, lng: 126.973000, desc: "삼각지 스페인 현지식 맛집. 추천 메뉴는 초리조로...", score: "4.6" },
            { curator: "예빈", name: "136길 육미", lat: 37.513000, lng: 127.035000, desc: "최강록 셰프가 오픈한 레스토랑. 꼭 1인 1메밀김밥...", score: "4.7" },
            { curator: "예빈", name: "롸카두들", lat: 37.535000, lng: 126.990000, desc: "솔직히 르프리크랑 롸카두들 빼고 버거집이 다 사라진다고...", score: "4.9" },
            { curator: "예빈", name: "한성대 양꼬치", lat: 37.588000, lng: 127.006000, desc: "고기로 승부보는 양꼬치 집..이하생략", score: "4.5" },
            { curator: "예빈", name: "스시지현", lat: 37.558000, lng: 126.925000, desc: "판초밥 계 희망 두 곳,,돈은 없지만 스시는 먹고 싶을 때 추천", score: "4.6" },
            { curator: "예빈", name: "옥자", lat: 37.560000, lng: 127.020000, desc: "쌀국수를 즐기지 않지만, 맛있는 쌀국수는 예외...", score: "4.4" },
            { curator: "예빈", name: "동꾼", lat: 37.560000, lng: 126.920000, desc: "고등어 봉초밥 입문자에게 추천하고픈 이자카야...", score: "4.7" },
            { curator: "예빈", name: "효자왕족발", lat: 37.578000, lng: 126.969000, desc: "주말 서촌에서 보쌈+족발 먹으려면 무조건 웨이팅...", score: "4.8" },
            { curator: "예빈", name: "북촌 막국수 제면소", lat: 37.585000, lng: 126.982000, desc: "북촌 끝 북악산 산 자락에 숨어있는 막국수집...", score: "4.5" },
            { curator: "예빈", name: "대복닭한마리", lat: 37.570000, lng: 127.005000, desc: "백부장집, 동대, 진옥화할매,,,다 가봤지만 고기는...", score: "4.6" },
            { curator: "예빈", name: "가양버섯칼국수 매운탕", lat: 37.550000, lng: 126.850000, desc: "고기빼고 전부 무한리필인 버.칼 집...", score: "4.9" },
            { curator: "예빈", name: "우공뭉티기", lat: 37.520000, lng: 127.040000, desc: "뭉티기 집에서 말아주는 육회비빔밥...", score: "4.8" },
            // --- 나의시선 ---
            { curator: "나의시선", name: "회현식당", lat: 37.558000, lng: 126.978000, desc: "점심 한상. 대접받는 기분 제대로.", score: "4.7" },
            { curator: "나의시선", name: "새벽집", lat: 37.525000, lng: 127.048000, desc: "육회비빔밥. 24시간 언제 가도 실패 없음.", score: "4.5" },
            { curator: "나의시선", name: "화목순대국", lat: 37.571000, lng: 126.974000, desc: "내장탕. 소주를 부르는 붉은 유혹.", score: "4.6" },
            { curator: "나의시선", name: "탑골순대국", lat: 37.480000, lng: 126.950000, desc: "고기 양 실화냐. 먹어도 먹어도 줄지 않는다.", score: "4.5" },
            { curator: "나의시선", name: "북천", lat: 37.530000, lng: 126.970000, desc: "돈까스 소스에 밥 비벼 먹고 싶음.", score: "4.8" },
            { curator: "나의시선", name: "섬집", lat: 37.528000, lng: 126.965000, desc: "매운탕. 국물이 끝내줘요.", score: "4.7" },
            { curator: "나의시선", name: "원조신촌설렁탕", lat: 37.557000, lng: 126.935000, desc: "내장곰탕. 겉모습에 속지 마라. 반전의 깔끔함.", score: "4.4" },
            { curator: "나의시선", name: "세이지핀치", lat: 37.580000, lng: 126.995000, desc: "토스트가 이렇게 예쁠 일인가.", score: "4.6" },
            { curator: "나의시선", name: "뚝배기라면", lat: 37.575000, lng: 126.980000, desc: "해장 완료.", score: "4.3" },
            { curator: "나의시선", name: "봉피양", lat: 37.510000, lng: 127.120000, desc: "방이점 평양냉면 + 돼지갈비. 통장은 텅장이...", score: "4.8" },
            { curator: "나의시선", name: "여래여거", lat: 37.580000, lng: 127.000000, desc: "나만 알고 싶은 곳. (이미 다 알지만)", score: "4.7" },
            { curator: "나의시선", name: "한남김밥", lat: 37.530000, lng: 127.005000, desc: "김밥이 요리다.", score: "4.5" },
            { curator: "나의시선", name: "고기리금잔디", lat: 37.350000, lng: 127.050000, desc: "더덕구이 향이 미쳤다.", score: "4.6" },
            { curator: "나의시선", name: "가담", lat: 37.525000, lng: 127.030000, desc: "고추탕수육. 맵단맵단.", score: "4.7" },
            { curator: "나의시선", name: "고래", lat: 37.545000, lng: 127.050000, desc: "사장님 마음대로. 그게 매력.", score: "4.5" },
            { curator: "나의시선", name: "임병주산동칼국수", lat: 37.485000, lng: 127.030000, desc: "김치 맛집. 칼국수는 거들 뿐.", score: "4.6" },
            { curator: "나의시선", name: "신성각", lat: 37.544000, lng: 126.958000, desc: "수타면의 불규칙한 식감이 재밌다. 짜장이 달지 않아서...", score: "4.4" },
            { curator: "나의시선", name: "영광통닭", lat: 37.560000, lng: 126.810000, desc: "닭똥집 튀김 주는 집은 무조건 합격.", score: "4.5" },
            { curator: "나의시선", name: "경복궁미역", lat: 37.575000, lng: 126.975000, desc: "미역국 돈 주고 사 먹는 거 이해 안 갔는데, 여긴 인정.", score: "4.6" },
            { curator: "나의시선", name: "토리요우", lat: 37.555000, lng: 126.920000, desc: "닭 껍질이 이렇게 고소했나?", score: "4.4" },
            { curator: "나의시선", name: "화양연화", lat: 37.578000, lng: 126.982000, desc: "분위기 깡패.", score: "4.7" },
            { curator: "나의시선", name: "반구정나루터집", lat: 37.850000, lng: 126.750000, desc: "장어 굽는 연기마저 맛있다.", score: "4.8" },
            { curator: "나의시선", name: "리북방", lat: 37.542000, lng: 126.950000, desc: "순대의 품격.", score: "4.6" },
            { curator: "나의시선", name: "명월관", lat: 37.555000, lng: 127.110000, desc: "갈비탕. 뷰가 반찬이다. 한강 보며 뜯는 갈비 맛이란.", score: "4.9" },
            // --- 서진 ---
            { curator: "서진", name: "오레노라멘 합정본점", lat: 37.548000, lng: 126.915000, desc: "5년 연속 미슐랭 선정! 가격은 9천원?", score: "4.8" },
            { curator: "서진", name: "낭만식탁", lat: 37.548000, lng: 126.920000, desc: "연어덮밥 맛집", score: "4.5" },
            { curator: "서진", name: "각시보쌈", lat: 37.549000, lng: 126.914000, desc: "보쌈 맛집", score: "4.4" },
            { curator: "서진", name: "백채김치찌개", lat: 37.548500, lng: 126.915500, desc: "김치찌개에 돼지고기 많이 넣어주십니다. 가격 1만원!", score: "4.6" },
            { curator: "서진", name: "마포만두", lat: 37.549500, lng: 126.913500, desc: "가성비의 끝, 만두 맛집", score: "4.3" },
            { curator: "서진", name: "우동카덴", lat: 37.552000, lng: 126.915000, desc: "두꺼운 우동 좋아하시면 추천", score: "4.7" },
            { curator: "서진", name: "멘타카무쇼", lat: 37.549000, lng: 126.920000, desc: "츠케멘 맛집", score: "4.6" },
            { curator: "서진", name: "우디집 도산점", lat: 37.525000, lng: 127.035000, desc: "커피 아이스크림 맛집", score: "4.5" },
            { curator: "서진", name: "아하 도산점", lat: 37.524000, lng: 127.036000, desc: "아사히볼 맛집", score: "4.4" },
            { curator: "서진", name: "아따", lat: 37.540000, lng: 127.050000, desc: "피자 소스가 엄청나요!", score: "4.6" },
            { curator: "서진", name: "컴피", lat: 37.545000, lng: 127.050000, desc: "컴피 피자 맛있어요~", score: "4.5" },
            { curator: "서진", name: "백부장집닭한마리", lat: 37.570000, lng: 127.005000, desc: "건강한맛!", score: "4.7" },
            { curator: "서진", name: "고슴도치 티라미수", lat: 37.550000, lng: 126.910000, desc: "티라미수 + 커피 맛있습니다. 귀여운 고슴도치...", score: "4.6" },
            { curator: "서진", name: "아쉑베리", lat: 37.525000, lng: 127.038000, desc: "메론빵 맛집!", score: "4.4" },
            { curator: "서진", name: "무대륙", lat: 37.546000, lng: 126.916000, desc: "카공 + 음악 듣기 좋아요, 음식도 팝니다...", score: "4.3" }
        ];

        let map;
        let markers = [];
        let activeInfoWindow = null; 
        let clickedMarker = null;

        // 토글 함수
        window.toggleDesc = function(id) {
            const shortSpan = document.getElementById(`desc-short-${id}`);
            const fullSpan = document.getElementById(`desc-full-${id}`);
            const btn = document.getElementById(`btn-${id}`);
            if (fullSpan.style.display === "none") {
                fullSpan.style.display = "inline";
                shortSpan.style.display = "none";
                btn.innerText = "[접기]";
            } else {
                fullSpan.style.display = "none";
                shortSpan.style.display = "inline";
                btn.innerText = "[더보기]";
            }
        };

        // 스타일 정의
        const hiddenStyle = [
            { "featureType": "all", "elementType": "geometry", "stylers": [{ "saturation": -100 }] },
            { "featureType": "all", "elementType": "labels", "stylers": [{ "visibility": "off" }] }
        ];

        const subwayStyle = [
            { "featureType": "all", "elementType": "geometry", "stylers": [{ "saturation": -100 }] },
            { "featureType": "all", "elementType": "labels", "stylers": [{ "visibility": "off" }] },
            // [핵심] 지하철(철도) 역만 보이게 설정
            {
                "featureType": "transit.station.rail",
                "elementType": "labels",
                "stylers": [{ "visibility": "on" }]
            },
            {
                "featureType": "transit.station.rail",
                "elementType": "geometry",
                "stylers": [{ "visibility": "on" }, { "lightness": -30 }]
            }
        ];

        function initMap() {
            // 3. 지도 옵션 설정 (서울 제한 + 초기 스타일)
            const mapOptions = {
                center: { lat: 37.566535, lng: 126.977969 },
                zoom: 12,
                minZoom: 11, // 너무 축소 안되게
                // [제한] 서울 경계 설정 (대략적)
                restriction: {
                    latLngBounds: {
                        north: 37.70, south: 37.40,
                        east: 127.18, west: 126.76
                    },
                    strictBounds: false
                },
                styles: hiddenStyle // 기본 스타일
            };

            map = new google.maps.Map(document.getElementById("map"), mapOptions);

            // [NEW] 줌 레벨 변경 감지 이벤트
            map.addListener("zoom_changed", () => {
                const zoomLevel = map.getZoom();
                // 줌 15 이상이면 지하철역 표시
                if (zoomLevel >= 15) {
                    map.setOptions({ styles: subwayStyle });
                } else {
                    map.setOptions({ styles: hiddenStyle });
                }
            });

            // 마커 생성
            restaurants.forEach((place, index) => {
                createMarker(place, index);
            });

            // 필터 UI
            createFilterUI();

            // 배경 클릭 시 고정 해제
            map.addListener("click", () => {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                    activeInfoWindow = null;
                }
                clickedMarker = null;
            });
        }

        function createMarker(place, index) {
            const curatorInfo = curators[place.curator];
            const iconImage = curatorInfo ? curatorInfo.iconUrl : "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
            
            // 설명 텍스트 토글
            const maxLen = 30;
            let descHtml = "";
            
            if (place.desc.length > maxLen) {
                const shortText = place.desc.substring(0, maxLen) + "...";
                descHtml = `
                    <span id="desc-short-${index}">${shortText}</span>
                    <span id="desc-full-${index}" style="display:none;">${place.desc}</span>
                    <button id="btn-${index}" class="toggle-btn" onclick="toggleDesc(${index})">[더보기]</button>
                `;
            } else {
                descHtml = `<span>${place.desc}</span>`;
            }

            // 통합 점수 배지 생성 (score가 없으면 랜덤값 대체 가능)
            const score = place.score ? place.score : "4.5"; 
            const badgeHtml = `<a href="https://www.google.com/search?q=${place.name}" target="_blank" class="score-badge">★ 통합 ${score}</a>`;

            const marker = new google.maps.Marker({
                position: { lat: place.lat, lng: place.lng },
                map: map,
                title: place.name,
                icon: {
                    url: iconImage,
                    scaledSize: new google.maps.Size(32, 32),
                    labelOrigin: new google.maps.Point(16, 40)
                },
                label: {
                    text: place.name,
                    color: "black",
                    fontWeight: "bold",
                    fontSize: "12px"
                },
                custom_curator: place.curator 
            });

            markers.push(marker);

            const contentString = `
                <div class="info-box">
                    <span class="curator-tag" style="color:${curatorInfo.color}">● By ${place.curator}</span>
                    <h4>${place.name}</h4>
                    <div class="desc-area">${descHtml}</div>
                    ${badgeHtml}
                </div>
            `;

            const infowindow = new google.maps.InfoWindow({
                content: contentString,
                disableAutoPan: true
            });

            marker.addListener("mouseover", () => {
                if (clickedMarker !== marker) { 
                    if (activeInfoWindow && !clickedMarker) activeInfoWindow.close();
                    infowindow.open(map, marker);
                    activeInfoWindow = infowindow;
                }
            });

            marker.addListener("mouseout", () => {
                if (clickedMarker !== marker) {
                    infowindow.close();
                    if (activeInfoWindow === infowindow) activeInfoWindow = null;
                }
            });

            marker.addListener("click", () => {
                if (activeInfoWindow) activeInfoWindow.close();
                clickedMarker = marker;
                infowindow.open(map, marker);
                activeInfoWindow = infowindow;
            });
        }

        function createFilterUI() {
            const container = document.getElementById("checkbox-container");
            const curatorNames = Object.keys(curators);

            curatorNames.forEach(name => {
                const wrapper = document.createElement("div");
                wrapper.className = "filter-item";

                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.checked = true; 
                checkbox.id = "chk-" + name;
                
                checkbox.addEventListener("change", function() {
                    filterMarkers(name, this.checked);
                });

                const colorDot = document.createElement("span");
                colorDot.className = "curator-color-dot";
                colorDot.style.backgroundColor = curators[name].color;

                const label = document.createElement("label");
                label.htmlFor = "chk-" + name;
                label.innerText = name;

                wrapper.appendChild(checkbox);
                wrapper.appendChild(colorDot);
                wrapper.appendChild(label);
                container.appendChild(wrapper);
            });
        }

        function filterMarkers(curatorName, isVisible) {
            markers.forEach(marker => {
                if (marker.custom_curator === curatorName) {
                    marker.setVisible(isVisible);
                }
            });
        }
    </script>
    
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACaTTCvvOZRAqaW2yVEwCJqQmOVCbbUrw&callback=initMap">
    </script>
</body>
</html>
